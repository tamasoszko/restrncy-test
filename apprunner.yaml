# apprunner.yaml
version: 1.0
runtime: python311

build:
  commands:
    # (Optional) pre-build steps here
    build:
      - pip3 install --no-cache-dir -r requirements.txt
    # (Optional) post-build steps here
  # (Optional) build-time envs
  # env:
  #   - name: PIP_DISABLE_PIP_VERSION_CHECK
  #     value: "1"

run:
  # Lock major.minor to 3.11 (optional, but recommended)
  runtime-version: 3.11

  # With the revised Python 3.11 build, anything installed outside /app
  # during "build" may not be present at runtime. Safest is to re-install here.
  pre-run:
    - pip3 install --no-cache-dir -r requirements.txt

  # Start your FastAPI app; App Runner injects $PORT
  command: python3 -m uvicorn api_server:app --host 0.0.0.0 --port 8000

  # Optional: explicitly set the listening port env name (App Runner also sets PORT)
  network:
    port: 8000

  # Runtime env & secrets (example)
  # env:
  #   - name: ENV
  #     value: "dev"
  # secrets:
  #   - name: OPENAI_API_KEY
  #     value-from: arn:aws:secretsmanager:eu-central-1:123456789012:secret:my-secret
